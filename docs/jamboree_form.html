<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>MG Jamboree 2025 Registration</title>
  <!-- Load the PayPal JS SDK -->
  <script src="https://www.paypal.com/sdk/js?client-id=AV3tPHQiTdXFl-AMQq_6Kd_5VvfnKOzSeMp1OCHfKafXBT_oQurHU_zhzrctGnIhCJOYoI-B40hYdvqw&currency=USD"></script>
  <style>
    #paypal-button-container {
      transition: opacity 0.3s ease;
    }
    
    .form-validation-message {
      color: #d32f2f;
      font-size: 14px;
      margin-bottom: 10px;
      display: none;
    }
    
    .form-validation-message.show {
      display: block;
    }
  </style>
</head>
<body>

  <form id="paymentForm">
    <label>
      First Name:
      <input type="text" id="firstName" name="firstName" required>
    </label>
    <br><br>

    <label>
      Last Name:
      <input type="text" id="lastName" name="lastName" required>
    </label>
    <br><br>

    <label>
      Other Attendees (if applicable):
      <br>
      <textarea id="attendees" name="attendees" rows="2" placeholder="First & Last Name"></textarea>
    </label>
    <br><br>

    <label>
      Address:
      <br>
      <textarea id="address" name="address" rows="4" placeholder="Street, City, State ZIP" required></textarea>
    </label>
    <br><br>

    <label>
      Phone Number:
      <input type="tel" id="phone" name="phone" required>
    </label>
    <br><br>

    <label>
      Email Address:
      <input type="email" id="email" name="email" required>
    </label>
    <br><br>
    <label>
      Year, Make, and Model:
      <input type="text" id="yearMakeModel" name="yearMakeModel" placeholder="e.g., 1965 MGB">
    </label>
    <br><br>

    <p><strong>LIABILITY RELEASE:</strong><br>
    I AM AWARE of the hazards inherent with motor vehicle events & specifically release & so indemnify the organizers, supporting sponsors, & the Florida Suncoast MG Car Club collectively & separately, for any & all liability from personal injury or property damage incurred by me or my guest(s) while participating in the MG Jamboree. I understand & agree that The Florida Suncoast MG Car Club reserves the right to revoke my registration & retain my registration fee should I engage in reckless, dangerous and/or unsafe behavior. I (We) have read, understand, and agree to this release.</p>

    <label>
      Digital Signature (Type Your Full Name):
      <br>
      <textarea id="signature" name="signature" rows="2" placeholder="Your typed name" required></textarea>
    </label>
    <br><br>

    <label>
      Registration Type:
      <select id="eventType" name="eventType">
        <option value="carShow">MG Jamboree 2025 Registration Only</option>
        <option value="boatTour">MG Jamboree and Pontoon Boat Tour</option>
      </select>
    </label>
    <br><br>

    <label id="participantsLabel" style="display:none;">
      Number of Participants for Pontoon Tour:
      <input type="number" id="participants" name="participants" min="1" value="1">
    </label>

    <label>
      Amount (USD):
      <input type="number" id="amount" name="amount" step="0.01" min="0.01" readonly>
    </label>
    <br><br>
    <div id="validation-message" class="form-validation-message">
      Please fill out all required fields before proceeding with payment.
    </div>
    <!-- The PayPal button will render here -->
    <div id="paypal-button-container"></div>
  </form>

  <script>
    function updateAmount() {
      var eventType = document.getElementById('eventType').value;
      var now = new Date();
      var cutoffCar = new Date('2025-09-01');
      var registrationFee = 0;
      var pontoonFee = 0;
      
      // Registration fee is always required
      registrationFee = now < cutoffCar ? 25 : 35;
      
      if (eventType === 'carShow') {
        // Car show only - just registration fee
        document.getElementById('participantsLabel').style.display = 'none';
        pontoonFee = 0;
      } else if (eventType === 'boatTour') {
        // Pontoon boat tour - registration fee plus pontoon fee
        var participants = parseInt(document.getElementById('participants').value) || 1;
        pontoonFee = participants * 25;
        document.getElementById('participantsLabel').style.display = 'block';
      }
      
      var totalAmount = registrationFee + pontoonFee;
      // Add 5% processing fee
      totalAmount = totalAmount * 1.05;
      document.getElementById('amount').value = totalAmount.toFixed(2);
      
      // Check form validation after amount update
      checkFormValidity();
    }

    function validateForm() {
      var firstName = document.getElementById('firstName').value.trim();
      var lastName = document.getElementById('lastName').value.trim();
      var address = document.getElementById('address').value.trim();
      var phone = document.getElementById('phone').value.trim();
      var email = document.getElementById('email').value.trim();
      var signature = document.getElementById('signature').value.trim();

      return firstName && lastName && address && phone && email && signature;
    }

    function checkFormValidity() {
      var paypalContainer = document.getElementById('paypal-button-container');
      var validationMessage = document.getElementById('validation-message');
      var isValid = validateForm();
      
      if (isValid) {
        paypalContainer.style.opacity = '1';
        paypalContainer.style.pointerEvents = 'auto';
        validationMessage.classList.remove('show');
      } else {
        paypalContainer.style.opacity = '0.5';
        paypalContainer.style.pointerEvents = 'none';
        validationMessage.classList.add('show');
      }
    }

    // Add event listeners to all required fields for real-time validation
    document.getElementById('firstName').addEventListener('input', checkFormValidity);
    document.getElementById('lastName').addEventListener('input', checkFormValidity);
    document.getElementById('address').addEventListener('input', checkFormValidity);
    document.getElementById('phone').addEventListener('input', checkFormValidity);
    document.getElementById('email').addEventListener('input', checkFormValidity);
    document.getElementById('signature').addEventListener('input', checkFormValidity);

    document.getElementById('eventType').addEventListener('change', updateAmount);
    document.getElementById('participants').addEventListener('input', updateAmount);
    window.addEventListener('load', function() {
      updateAmount();
      checkFormValidity();
    });

    // Wait until the SDK is loaded
    paypal.Buttons({

      // Called when the user clicks the button
      createOrder: function(data, actions) {
        // Double-check form validation before processing payment
        if (!validateForm()) {
          alert('Please fill out all required fields before proceeding with payment.');
          return Promise.reject(new Error('Form validation failed'));
        }
        
        var amt = parseFloat(document.getElementById('amount').value).toFixed(2);
        return actions.order.create({
          purchase_units: [{
            amount: { value: amt }
          }]
        });
      },

      // Called after the payment is approved
      onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
          // Optionally send details to your server here

          // Finally, redirect to a thank-you or next step
          window.location.href = 'https://your-site.com/thank-you';
        });
      },

      // Optional: handle cancellations or errors
      onCancel: function (data) {
        alert('Payment cancelled.');
      },
      onError: function (err) {
        console.error('PayPal error', err);
        alert('Something went wrongâ€”you can try again.');
      }

    }).render('#paypal-button-container');
  </script>

</body>
</html>